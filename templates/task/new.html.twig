{% extends 'base.html.twig' %}

{% block title %}Ajouter une tâche{% endblock %}

{% block body %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="stats-card text-start">
            <h2 class="mb-4">Ajouter une tâche</h2>

            {{ form_start(form) }}
                <div class="mb-3">
                    {{ form_row(form.title, {'attr': {'class': 'form-control', 'placeholder': 'Titre de la tâche'}}) }}
                </div>
                <div class="mb-3">
                    {{ form_row(form.description, {'attr': {'class': 'form-control', 'rows': 4, 'placeholder': 'Description...'}}) }}
                </div>
                {#  PRIORITÉ (APRÈS DESCRIPTION) #}
                <div class="mb-3">
                    {{ form_row(form.priority, {'attr': {'class': 'form-select'}}) }}
                </div>

                 <div class="row">
                    <div class="col-md-6 mb-3">
                         {{ form_row(form.deadline, {'attr': {'class': 'form-control'}}) }}
                    </div>
                        {# Custom Circular Checkbox #}
                        <div class="mb-3">
                            <label class="form-label d-block">État de la tâche</label>
                            <div class="d-flex align-items-center gap-3">
                                <div class="position-relative">
                                    {{ form_widget(form.status, {'attr': {'class': 'd-none status-checkbox'}}) }}
                                    <label for="{{ form.status.vars.id }}" class="circle-check-label">
                                        <i class="bi bi-check-lg check-icon"></i>
                                    </label>
                                </div>
                                <span class="text-muted" id="status-text">
                                    {{ form.status.vars.data ? 'Tâche terminée' : 'Marquer comme terminée' }}
                                </span>
                            </div>
                            {{ form_errors(form.status) }}
                        </div>
                </div>

                <div class="d-flex justify-content-between align-items-center mt-4 pt-3 border-top" style="border-color: var(--glass-border) !important;">
                    <a href="{{ path('task_index') }}" class="btn btn-secondary">
                        <i class="bi bi-arrow-left"></i> Retour
                    </a>
                    <button type="submit" class="btn btn-primary px-4">
                        <i class="bi bi-plus-lg"></i> Créer
                    </button>
                </div>
            {{ form_end(form) }}
        </div>
    </div>
</div>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const checkbox = document.querySelector('.status-checkbox');
        const statusText = document.getElementById('status-text');

        function updateStatus() {
            if (checkbox.checked) {
                statusText.textContent = "Tâche terminée";
                statusText.classList.remove('text-muted');
                statusText.classList.add('text-success', 'fw-bold');
            } else {
                statusText.textContent = "Marquer comme terminée";
                statusText.classList.add('text-muted');
                statusText.classList.remove('text-success', 'fw-bold');
            }
        }

        if (checkbox && statusText) {
            checkbox.addEventListener('change', updateStatus);
            // Initialize state
            updateStatus();
        }
    });
</script>
{% endblock %}
