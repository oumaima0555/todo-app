{% extends 'base.html.twig' %}

{% block title %}Liste des t√¢ches{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/index.css') }}">
    {# Bootstrap Icons #}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
{% endblock %}

{% block body %}
    {# 1Ô∏è‚É£ Compteurs de t√¢ches #}
    <div class="row mb-4 text-center">
        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title text-primary">Total</h5>
                    <p class="card-text display-6">{{ counters.total }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title text-success">Termin√©es</h5>
                    <p class="card-text display-6">{{ counters.done }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-4">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title text-warning">√Ä faire</h5>
                    <p class="card-text display-6">{{ counters.todo }}</p>
                </div>
            </div>
        </div>
    </div>

    {# üîç Recherche et Filtres #}
    <div class="card mb-4">
        <div class="card-body">
            <form method="get" class="row g-3">
                <div class="col-md-6">
                    <input type="text" name="q" class="form-control" placeholder="Rechercher par titre..." value="{{ searchParams.q }}">
                </div>
                <div class="col-md-4">
                    <select name="status" class="form-select">
                        <option value="">Tous les statuts</option>
                        <option value="done" {{ searchParams.status == 'done' ? 'selected' : '' }}>Termin√©es</option>
                        <option value="todo" {{ searchParams.status == 'todo' ? 'selected' : '' }}>√Ä faire</option>
                    </select>
                </div>
                <div class="col-md-2">
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> Filtrer
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Mes t√¢ches</h2>
        <a href="{{ path('task_new') }}" class="btn btn-primary">
            <i class="bi bi-plus-circle"></i> Ajouter une t√¢che
        </a>
    </div>

<table class="table table-bordered table-hover">
    <thead class="table-dark">
        <tr>
            <th>ID</th>
            <th>Titre</th>
            <th>Date limite</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
   {% for task in tasks %}
    <tr class="{{ (task.deadline and task.deadline < date() and not task.status) ? 'table-danger' : '' }}">
        <td>{{ task.id }}</td>
        <td>
            {{ task.title }}
            {% if task.description %}
                <br><small class="text-muted">{{ task.description|u.truncate(50, '...') }}</small>
            {% endif %}
        </td>
        
        {# ‚è∞ Date limite #}
        <td>
            {% if task.deadline %}
                <span class="{{ (task.deadline < date() and not task.status) ? 'text-danger fw-bold' : '' }}">
                    {{ task.deadline|date('d/m/Y') }}
                </span>
            {% else %}
                <span class="text-muted">-</span>
            {% endif %}
        </td>

        <!-- ‚úÖ STATUT VISUEL -->
        <td>
            <span class="badge {{ task.status ? 'bg-success' : 'bg-warning text-dark' }}">
                {{ task.status ? 'Termin√©e' : '√Ä faire' }}
            </span>
        </td>

        <td>
            <a href="{{ path('task_show', {'id': task.id}) }}" class="btn btn-info btn-sm" title="Voir">
                <i class="bi bi-eye"></i>
            </a>

            <a href="{{ path('task_edit', {'id': task.id}) }}" class="btn btn-warning btn-sm" title="Modifier">
                <i class="bi bi-pencil"></i>
            </a>

            <form action="{{ path('task_delete', {'id': task.id}) }}" method="post" style="display:inline-block;" onsubmit="return confirm('√ätes-vous s√ªr ?');">
                <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ task.id) }}">
                <button type="submit" class="btn btn-danger btn-sm" title="Supprimer">
                    <i class="bi bi-trash"></i>
                </button>
            </form>
        </td>
    </tr>
   {% else %}
    <tr>
        <td colspan="6" class="text-center py-4">
            <i class="bi bi-inbox fs-1 text-muted d-block mb-2"></i>
            Aucune t√¢che trouv√©e
        </td>
    </tr>
 {% endfor %}
    </tbody>
  </table>
{% endblock %}
