{# templates/debug/test.html.twig #}
<!DOCTYPE html>
<html>
<head>
    <title>Debug Database</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; margin: 20px 0; }
        th, td { border: 1px solid #ccc; padding: 8px; }
        th { background: #f0f0f0; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .warning { color: orange; }
        pre { background: #f5f5f5; padding: 10px; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ” Test de la base de donnÃ©es</h1>
    
    <h2>ğŸ“Š RÃ©sultat de l'insertion :</h2>
    {% if new_id %}
        <p class="success">âœ… TÃ¢che crÃ©Ã©e avec ID: {{ new_id }}</p>
    {% else %}
        <p class="error">âŒ Aucun ID gÃ©nÃ©rÃ© - L'insertion a Ã©chouÃ©</p>
    {% endif %}
    
    <h2>ğŸ“‹ TÃ¢ches dans la table ({{ tasks|length }}) :</h2>
    {% if tasks|length > 0 %}
        <table>
            <tr>
                <th>ID</th>
                <th>Title</th>
                <th>Description</th>
                <th>Status</th>
                <th>Created At</th>
            </tr>
            {% for task in tasks %}
            <tr>
                <td>{{ task.id }}</td>
                <td>{{ task.title }}</td>
                <td>{{ task.description|slice(0, 50) ~ (task.description|length > 50 ? '...' : '') }}</td>
                <td>{{ task.status ? 'âœ… TerminÃ©e' : 'â³ En cours' }}</td>
                <td>{{ task.createdAt ? task.createdAt|date('d/m/Y H:i:s') : 'Non dÃ©fini' }}</td>
            </tr>
            {% endfor %}
        </table>
    {% else %}
        <p class="warning">âš ï¸ Aucune tÃ¢che trouvÃ©e dans la table</p>
    {% endif %}
    
    <h2>ğŸ—ï¸ Structure de la table "task" :</h2>
    <table>
        <tr>
            <th>Champ</th>
            <th>Type</th>
            <th>Null</th>
            <th>ClÃ©</th>
            <th>DÃ©faut</th>
            <th>Extra</th>
        </tr>
        {% for column in table_structure %}
        <tr>
            <td>{{ column.Field }}</td>
            <td>{{ column.Type }}</td>
            <td>{{ column.Null }}</td>
            <td>{{ column.Key }}</td>
            <td>{{ column.Default }}</td>
            <td>{{ column.Extra }}</td>
        </tr>
        {% else %}
        <tr><td colspan="6" class="error">âŒ Table 'task' non trouvÃ©e</td></tr>
        {% endfor %}
    </table>
    
    <h2>ğŸ”— Actions de dÃ©bogage :</h2>
    <ul>
        <li><a href="{{ path('debug_test_db') }}">ğŸ”„ Relancer le test d'insertion</a></li>
        <li><a href="{{ path('debug_clear_tasks') }}" onclick="return confirm('Vider toute la table ?')">ğŸ—‘ï¸ Vider la table task</a></li>
        <li><a href="{{ path('debug_sql_test') }}">âš¡ Test SQL direct</a></li>
        <li><a href="{{ path('task_new') }}">ğŸ“ Retour au formulaire de crÃ©ation</a></li>
        <li><a href="{{ path('task_index') }}">ğŸ“‹ Voir la liste des tÃ¢ches</a></li>
    </ul>
    
    <h2>ğŸ“ Commandes Ã  exÃ©cuter dans le terminal :</h2>
    <pre>
# VÃ©rifier la table
php bin/console doctrine:query:sql "SELECT * FROM task"

# VÃ©rifier la structure
php bin/console doctrine:query:sql "DESCRIBE task"

# VÃ©rifier toutes les tables
php bin/console doctrine:query:sql "SHOW TABLES"

# Test d'insertion SQL
php bin/console doctrine:query:sql "INSERT INTO task (title, description, status, created_at) VALUES ('Test CLI', 'Test terminal', 0, NOW())"
    </pre>
</body>
</html>